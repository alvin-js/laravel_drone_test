---
kind: pipeline
type: docker
name: test

platform:
  os: linux
  arch: amd64

steps:
  - name: publish_nginx
    image: plugins/gcr
    settings:
      registry: asia.gcr.io
      repo: nodal-wall-248502/docker_compose_nginx_build
      tags: latest
      dockerfile: dockerfiles/dockerfile_for_nginx/Dockerfile
      json_key: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibm9kYWwtd2FsbC0yNDg1MDIiLAogICJwcml2YXRlX2tleV9pZCI6ICIxZDU2ZGE1ZjA3N2EwNTgwYjMzYzUyMzEwNGRjYWM2MTY3OWRjYWQzIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdmdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLZ3dnZ1NrQWdFQUFvSUJBUURQYklHaFAyRnY5dUFDXG5kMWRENW01dWtTOHAwMlJUenFxaTJ6Wi9Rd280TUpWaUVxRlRhYjkwZXI4cU9CUzN0RldrczBiUk9MYmFjTU15XG51Nm1FWjBXVGVyaG9ENXNzUklmVEdhdWhhejhrNHN3NzNGbUZydTZDaFZVc3VRcUViMHJaYWR2amNCWGM0YmF2XG51ZUlxcXYwMWV0a1VNTHNDd1NVQzJEeHJNcWxobm82dGU4bTVmUmp6NWhleEFVVGRrYXp4NlJ3ZWViYWVINTlmXG5yemNnTllmUjd2eFNuSFdxSzJiaTNPQXJwdDBlenNiSm02Mm1WUnl0MEhTN00wVHRDT0VQVGhid1hLYnpXakpDXG5PcTZ2Zmt4TElWblBxenFQQkZORTVmK0t3VUFpSXpLdDVKWjVHeEFNdVRNTWg2T1lBUTZIaWlpTFZEZUM2U1NnXG5qU21CVVJKZkFnTUJBQUVDZ2dFQUhkYnFQeHd6RkR4YnRYOGRtck1IcC9oUzVKMTRqV1hwdmt2eTV4UHA0SE44XG55Z01NR2tmWU54V0JjcjFtblpiZnl6WFBOa0lHYkI1VXRuT3d5MDlmL3Z0a2svUEt5dStBNnFtQ3UxSUdYM1FSXG5GWHQ1bFhXNDhpWGtQdTdQeUlXS0t3VERrVkNLbEtBVCsrdXQwWjJQbDZYNG5LTDJCRXRzMjUvbjhUUDBrZ3BPXG45d2w2Q2hOc2ZRWDdMYnkrNFc1Q2RQK3h4ZFNZQXI3ZmxqOWpVNUFxRC9wQkpDRjl3clVMRGZ2Y1ZIR0tDZUlmXG5QM2YwSVBOaHVIMExObHJ1SVNhWXFGdTYyQUxlSTF3UTNjMGRSOXRwTDBTRUtWWEhXZmticTd6QjY0Q0pwaUlGXG5UVDdjS0t1R1Q5cmxxQUxzRW5pakl0M0pJNWtpd1p2ZnhLMmFuNHMzb1FLQmdRRHd1VGNZbEJXTWhac0pRL0pLXG45dmhtMTBieVBKcHJndTJaYVo0cDBZa2crYzdHK2lWOUhpTHE3SFdidDBFRWZKVUg1VmlHYkJRd3VIY3VtaDB2XG5nNjcwUGRIK2VUSGdNQkJXWHZMUHJBa0ZiY1B0Q014d045TXdkTy9YSkNObWRSMWlWQW9XMnR2UG1CRURrdm1QXG5BU3Y2TE9CRHFCTEZqTkFVSkg1cTRCNDBoUUtCZ1FEY2xrNXdHV3JZam1BZktQWGVzRUx1Q2hEZmpNT240UjR4XG5SR2QzQkJJRTN5MVI5RnhyQlBPVkwrT1E2T054azNNcnlYVG9wR0dtY3lmZEFpNmQ3M2ZhWWUzVnJQNFVDTmx3XG5UNE9HUUNkZmpqK3VPRkZicThub3lrMVVLaWxIRmJ2NC9mWjdnTzRsVWNKdHZWQkhEbVZHQU95dzB4NkVQZ2xqXG5BK1VPYmNaaWt3S0JnRFFmQmt6dUUxUmZ3VmZhUEdYNjM0SDA3c21ZVVo4aHRDeFpjQU9CK1AwSTJicS9nc3A2XG5jZmtIeGRjM2NINTJNeGFJbEFoVzhuQXlJS3dZZG1WSlQrSldXRmVQQ2p1T2JKc201OUFMWWRDcEdaa0RKTERQXG5oWXlpWlNQaUVVQW43M3JRMDNacllOaXNCbE1OeWJjcSs4aXBXczJMWUxVaGJoUk9hb2pkaWV5NUFvR0JBTHp2XG5USzI5UjRQR3B0UHBuSFlwV0pwVUt0R2UyckovSWdJbXljdnB3NWxDb3Ftd2VEdjkyTGh1ZFNiWUluOVVRUEEvXG5OQkJUUTRSeTI3RHp2b1B0NlNVMmZhUm44Sk91WkxkS2s2ZTRhVUR5TU44RFE4UVY1dkdwM1FQNnZMSXpEbmFjXG41N0l1NDBzNXRTT1RaQ0FJVjN2WExPUGpZQjc2bDhXa1AxdlZjSGRiQW9HQkFJam84Z0dXMkl6K01jMzkrODFtXG5wZW05NVNjU2hETklCbWlHREJyZ0JGdVZjNDU1aUlKWkwwc1JEc0lYRWJFMFcrL1pzdWMrSXJXQVNGQUlpaDFkXG4yNUorVEhKUHVRdEx5SFk5NjNqa3o0WjM3Rk5rc1FEczNmL2l3MnB4VWxsZTRYamhIekxWbzJSWDZhK2tPZzZWXG5QZEhNRE9lRm1GaHovdGlKdGVlMnVFUVVcbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJhY2Nlc3MtZ2NyQG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjEwOTIyMzE5NTk2OTQ4NzkzOTAyNyIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvYWNjZXNzLWdjciU0MG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9
  - name: publish_php
    image: plugins/gcr
    settings:
      registry: asia.gcr.io
      repo: nodal-wall-248502/docker_compose_php73_laravel_build
      tags: latest
      dockerfile: dockerfiles/dockerfile_for_laravel/Dockerfile
      json_key: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibm9kYWwtd2FsbC0yNDg1MDIiLAogICJwcml2YXRlX2tleV9pZCI6ICIxZDU2ZGE1ZjA3N2EwNTgwYjMzYzUyMzEwNGRjYWM2MTY3OWRjYWQzIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdmdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLZ3dnZ1NrQWdFQUFvSUJBUURQYklHaFAyRnY5dUFDXG5kMWRENW01dWtTOHAwMlJUenFxaTJ6Wi9Rd280TUpWaUVxRlRhYjkwZXI4cU9CUzN0RldrczBiUk9MYmFjTU15XG51Nm1FWjBXVGVyaG9ENXNzUklmVEdhdWhhejhrNHN3NzNGbUZydTZDaFZVc3VRcUViMHJaYWR2amNCWGM0YmF2XG51ZUlxcXYwMWV0a1VNTHNDd1NVQzJEeHJNcWxobm82dGU4bTVmUmp6NWhleEFVVGRrYXp4NlJ3ZWViYWVINTlmXG5yemNnTllmUjd2eFNuSFdxSzJiaTNPQXJwdDBlenNiSm02Mm1WUnl0MEhTN00wVHRDT0VQVGhid1hLYnpXakpDXG5PcTZ2Zmt4TElWblBxenFQQkZORTVmK0t3VUFpSXpLdDVKWjVHeEFNdVRNTWg2T1lBUTZIaWlpTFZEZUM2U1NnXG5qU21CVVJKZkFnTUJBQUVDZ2dFQUhkYnFQeHd6RkR4YnRYOGRtck1IcC9oUzVKMTRqV1hwdmt2eTV4UHA0SE44XG55Z01NR2tmWU54V0JjcjFtblpiZnl6WFBOa0lHYkI1VXRuT3d5MDlmL3Z0a2svUEt5dStBNnFtQ3UxSUdYM1FSXG5GWHQ1bFhXNDhpWGtQdTdQeUlXS0t3VERrVkNLbEtBVCsrdXQwWjJQbDZYNG5LTDJCRXRzMjUvbjhUUDBrZ3BPXG45d2w2Q2hOc2ZRWDdMYnkrNFc1Q2RQK3h4ZFNZQXI3ZmxqOWpVNUFxRC9wQkpDRjl3clVMRGZ2Y1ZIR0tDZUlmXG5QM2YwSVBOaHVIMExObHJ1SVNhWXFGdTYyQUxlSTF3UTNjMGRSOXRwTDBTRUtWWEhXZmticTd6QjY0Q0pwaUlGXG5UVDdjS0t1R1Q5cmxxQUxzRW5pakl0M0pJNWtpd1p2ZnhLMmFuNHMzb1FLQmdRRHd1VGNZbEJXTWhac0pRL0pLXG45dmhtMTBieVBKcHJndTJaYVo0cDBZa2crYzdHK2lWOUhpTHE3SFdidDBFRWZKVUg1VmlHYkJRd3VIY3VtaDB2XG5nNjcwUGRIK2VUSGdNQkJXWHZMUHJBa0ZiY1B0Q014d045TXdkTy9YSkNObWRSMWlWQW9XMnR2UG1CRURrdm1QXG5BU3Y2TE9CRHFCTEZqTkFVSkg1cTRCNDBoUUtCZ1FEY2xrNXdHV3JZam1BZktQWGVzRUx1Q2hEZmpNT240UjR4XG5SR2QzQkJJRTN5MVI5RnhyQlBPVkwrT1E2T054azNNcnlYVG9wR0dtY3lmZEFpNmQ3M2ZhWWUzVnJQNFVDTmx3XG5UNE9HUUNkZmpqK3VPRkZicThub3lrMVVLaWxIRmJ2NC9mWjdnTzRsVWNKdHZWQkhEbVZHQU95dzB4NkVQZ2xqXG5BK1VPYmNaaWt3S0JnRFFmQmt6dUUxUmZ3VmZhUEdYNjM0SDA3c21ZVVo4aHRDeFpjQU9CK1AwSTJicS9nc3A2XG5jZmtIeGRjM2NINTJNeGFJbEFoVzhuQXlJS3dZZG1WSlQrSldXRmVQQ2p1T2JKc201OUFMWWRDcEdaa0RKTERQXG5oWXlpWlNQaUVVQW43M3JRMDNacllOaXNCbE1OeWJjcSs4aXBXczJMWUxVaGJoUk9hb2pkaWV5NUFvR0JBTHp2XG5USzI5UjRQR3B0UHBuSFlwV0pwVUt0R2UyckovSWdJbXljdnB3NWxDb3Ftd2VEdjkyTGh1ZFNiWUluOVVRUEEvXG5OQkJUUTRSeTI3RHp2b1B0NlNVMmZhUm44Sk91WkxkS2s2ZTRhVUR5TU44RFE4UVY1dkdwM1FQNnZMSXpEbmFjXG41N0l1NDBzNXRTT1RaQ0FJVjN2WExPUGpZQjc2bDhXa1AxdlZjSGRiQW9HQkFJam84Z0dXMkl6K01jMzkrODFtXG5wZW05NVNjU2hETklCbWlHREJyZ0JGdVZjNDU1aUlKWkwwc1JEc0lYRWJFMFcrL1pzdWMrSXJXQVNGQUlpaDFkXG4yNUorVEhKUHVRdEx5SFk5NjNqa3o0WjM3Rk5rc1FEczNmL2l3MnB4VWxsZTRYamhIekxWbzJSWDZhK2tPZzZWXG5QZEhNRE9lRm1GaHovdGlKdGVlMnVFUVVcbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJhY2Nlc3MtZ2NyQG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjEwOTIyMzE5NTk2OTQ4NzkzOTAyNyIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvYWNjZXNzLWdjciU0MG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9

#- name: ssh-git-pull
#  pull: if-not-exists
#  image: appleboy/drone-ssh
#  environment:
#    ENV:
#      from_secret: env
#  settings:
#    host: 35.229.238.232
#    username: alvin
#    port: 22
#    key:
#      from_secret: privateKey
#    envs: [ENV]
#    script:
#      - cd /var/www/html/laravel_drone_test
#      - sudo git pull
#      - echo $${ENV}
#      - echo $${ENV} | sudo tee .env


#- name: build-nginx-image
#  pull: if-not-exists
#  image: plugins/docker
#  settings:
#    registry: registry.hub.docker.com
#    repo: registry.hub.docker.com/virtualorz/docker_compose_nginx_build
#    dockerfile: dockerfiles/dockerfile_for_nginx/Dockerfile
#    auto_tag: true
#    username: virtualorz
#    password: 2uxirgil

#- name: build-php-image
#  pull: if-not-exists
#  image: plugins/docker
#  settings:
#    registry: registry.hub.docker.com
#    repo: registry.hub.docker.com/virtualorz/dev_compose_php73_laravel_build
#    dockerfile: dockerfiles/dockerfile_for_laravel/Dockerfile
#    auto_tag: true
#    username: virtualorz
#    password: 2uxirgil
