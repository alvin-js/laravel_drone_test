---
kind: pipeline
type: docker
name: test

platform:
  os: linux
  arch: amd64

steps:
  - name: publish_nginx
    image: plugins/gcr
    settings:
      registry: asia.gcr.io
      repo: nodal-wall-248502/docker_compose_nginx_build
      tags: latest
      dockerfile: dockerfiles/dockerfile_for_nginx/Dockerfile
      json_key: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibm9kYWwtd2FsbC0yNDg1MDIiLAogICJwcml2YXRlX2tleV9pZCI6ICJhOTdiMzVjYzIwNzdiNzc1MThmODllNjJhMDEyY2YyOGM0NmQ1NjExIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdmdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLZ3dnZ1NrQWdFQUFvSUJBUURVdkRJRXJkNC9RVDVVXG5wWm5hbzREMnFENFFtNTVPWE00WkV3QXVjd2lNZHhaRjJYSEJoYjFVTzdjMEpUZG55K2p3WEQxcTRTcCtuUnJVXG5JMng4elNIdm9TT0tvdXVtdDlwamxlQ004SHBXN3JZdGlqSHpCQWc0cTFmeUp2YnZjcWRzOHVkUVJMZ29oRnZpXG4yT3A1UXJHMlE3YXIwVWM5elBmNktIQ3ZMakxwcURLcEo0QXR6VmtHVXhYQ2lISzF0clhlRldITHZyR0lrNXptXG51UGpaWnRESG16anQ3K1N6UlhiWDc3VmptQXR1cE1wd0tTNmRMV3lnN0lTVHY1RUFSUkF5SkU1NmhGUHRYT1RuXG5BYjZ3NDdvVy9QWmd0OTFRNk91bHptVmJPVExjRXRwOExmMGgyZUtXUGYzUDA1eUtHZW1nRU5jY1BGK2l3Qmk1XG45bXA1YVk2MUFnTUJBQUVDZ2dFQVgvMEd5S3UzSTIySjlXRy9lVExiWnZCbENOTmU2OWJlTzl3aDhkTi80UGwrXG4rRWQwRjdFRHk3VWlKZ3BBNUxuU1Fsb3NjRVJuQ3poU09iUStLRlhhNFNnaFJGWGM1SjRDa1hxNEZvQVBnNWcwXG5aWG44cmIxOUJDejBBdFJvQ1lUL1hKNkJsdXRhK1JVMzdMU1puOXRqR20yVlNCT25CSkN1dDVaMXVlV3JuVmV2XG5lcTZHLzRzTzIwWGxDaGxzRlN3NTNjYnlSWU1HaDh1QkxuLytIcktVVzZFNzVzenR3WTNPSXFYb01TN3ZJOFFyXG5yMUQ0KzFTVDIvbEZQUE9Kc0R6Q2ptY3hrMFI5RmlzUXVoVVJqTnVjQTNBWEhsd2NIbGtVNTBlUzM1azAxL3dOXG5ZNmlKUWlqSjRWTzdXMHoweFZEcFlYU2FvQmFwdE0zTlhKUnF3M0FpUlFLQmdRRDRWd3p0cmZZeWxsKzdQb3kzXG5mVjlLZGtkU01uVzNWK1Y4cmRIdkJuaTIvTW1FVUZ3REIrN2wrL0NraHFDN0ZsTFB6dnVZaWlyOG9XVFZOWUdzXG4yYmxpcmNHOUV4WGEwcnRrUGVMOW1XZThHa3lMek9iSjg0ZlVRMFFkQmFwNThWK0dkUDFwRjBjWXVPZ1p2Y3RzXG5zYytub3RmWU16OEJhaHlzMkZDMklxYkZTd0tCZ1FEYlRBQWViSWpYeXdhWWZmUTNJaEthaXlVYm93b0JSZk5RXG5XT09hMHl6U09OSDRKQThhTUFENXVsaUJDcDB3dVJ6b0t4cy9jc21ENVdrTHJWeDRxQ3h4UjRjTzE0UE5HVFcwXG5kSGdnQUNCREpnSTY0OW1TbzA5UTZzWDJweGIwck9GK1ZFN2hBN1UzdEl2bGxjeW82OUNNdjdzdVUrLzZMT2RQXG5KMTExTFlCNy93S0JnUURDNVVadkxjeCt6UWJhWTI5NS9YbVFiWnp4aEVwZ0Zpb3pIQk1hdklCMlU1TXZOUVhSXG5GeVBFK0dGV0xaWHMzY3NsN2JJRWQ4TGV1eWJ3TU9yUkpablpPTFpJVmJjY0liQVJMb1I3TkM1Mk1FbU1tY1V5XG5EdDYxbGdqWm9mMjFiOW5oSXVWUjJZUGhnaFFkUjVkamVYU1hnalJWSjNxMStIb0NxRTFIYzVCZ1d3S0JnUUNXXG5XSldnUmlMUFoyYi9OeU11aFZLaDE1RzZUOTMxSDRMLzYrRW5iVzVHTmlSbDdqcllabDdVMTFnRUtFVzZlTDhEXG53VUh1RHdGdlJ1SHMybzhTUGFJeWk2cGhsNG5LSEdXQWNYVkY0ekE3T1J6QVNTUUtiNkphUklzeVhqM1R3NDdaXG5NRzNmd000R0FlY0RvTjd1VkxYbk9TL1lSRDI3ay91RmZlU0tDSWNVK3dLQmdHbTIzNlBNVzRsUWIzaTJyZ0lhXG5sT3d1bHoraEJoTlJVUXBoRFZLd1lYS1BlTHdvL2crZzFybnU5MVRCb2JyYnRRWFFabWE0Z002emlHOTVzMXlUXG5NanR2aHJyVmNOa1cyNXlMNmFzRlNTLytlZXZXcjJvQTVubXAzUHNMNG4rTFhYaWc1QzFtTEVuQlFFZVpoSmdKXG5EQzdlTEpibng4UFZmY3VWM0s4UStBMUdcbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJhY2Nlcy1nY3ItaW1hZ2VzQG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjEwODkwNDI2NzczMzQ4NzgyNjk0OSIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvYWNjZXMtZ2NyLWltYWdlcyU0MG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9Cg==
  - name: publish_php
    image: plugins/gcr
    settings:
      registry: asia.gcr.io
      repo: nodal-wall-248502/docker_compose_php73_laravel_build
      tags: latest
      dockerfile: dockerfiles/dockerfile_for_laravel/Dockerfile
      json_key: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibm9kYWwtd2FsbC0yNDg1MDIiLAogICJwcml2YXRlX2tleV9pZCI6ICJhOTdiMzVjYzIwNzdiNzc1MThmODllNjJhMDEyY2YyOGM0NmQ1NjExIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdmdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLZ3dnZ1NrQWdFQUFvSUJBUURVdkRJRXJkNC9RVDVVXG5wWm5hbzREMnFENFFtNTVPWE00WkV3QXVjd2lNZHhaRjJYSEJoYjFVTzdjMEpUZG55K2p3WEQxcTRTcCtuUnJVXG5JMng4elNIdm9TT0tvdXVtdDlwamxlQ004SHBXN3JZdGlqSHpCQWc0cTFmeUp2YnZjcWRzOHVkUVJMZ29oRnZpXG4yT3A1UXJHMlE3YXIwVWM5elBmNktIQ3ZMakxwcURLcEo0QXR6VmtHVXhYQ2lISzF0clhlRldITHZyR0lrNXptXG51UGpaWnRESG16anQ3K1N6UlhiWDc3VmptQXR1cE1wd0tTNmRMV3lnN0lTVHY1RUFSUkF5SkU1NmhGUHRYT1RuXG5BYjZ3NDdvVy9QWmd0OTFRNk91bHptVmJPVExjRXRwOExmMGgyZUtXUGYzUDA1eUtHZW1nRU5jY1BGK2l3Qmk1XG45bXA1YVk2MUFnTUJBQUVDZ2dFQVgvMEd5S3UzSTIySjlXRy9lVExiWnZCbENOTmU2OWJlTzl3aDhkTi80UGwrXG4rRWQwRjdFRHk3VWlKZ3BBNUxuU1Fsb3NjRVJuQ3poU09iUStLRlhhNFNnaFJGWGM1SjRDa1hxNEZvQVBnNWcwXG5aWG44cmIxOUJDejBBdFJvQ1lUL1hKNkJsdXRhK1JVMzdMU1puOXRqR20yVlNCT25CSkN1dDVaMXVlV3JuVmV2XG5lcTZHLzRzTzIwWGxDaGxzRlN3NTNjYnlSWU1HaDh1QkxuLytIcktVVzZFNzVzenR3WTNPSXFYb01TN3ZJOFFyXG5yMUQ0KzFTVDIvbEZQUE9Kc0R6Q2ptY3hrMFI5RmlzUXVoVVJqTnVjQTNBWEhsd2NIbGtVNTBlUzM1azAxL3dOXG5ZNmlKUWlqSjRWTzdXMHoweFZEcFlYU2FvQmFwdE0zTlhKUnF3M0FpUlFLQmdRRDRWd3p0cmZZeWxsKzdQb3kzXG5mVjlLZGtkU01uVzNWK1Y4cmRIdkJuaTIvTW1FVUZ3REIrN2wrL0NraHFDN0ZsTFB6dnVZaWlyOG9XVFZOWUdzXG4yYmxpcmNHOUV4WGEwcnRrUGVMOW1XZThHa3lMek9iSjg0ZlVRMFFkQmFwNThWK0dkUDFwRjBjWXVPZ1p2Y3RzXG5zYytub3RmWU16OEJhaHlzMkZDMklxYkZTd0tCZ1FEYlRBQWViSWpYeXdhWWZmUTNJaEthaXlVYm93b0JSZk5RXG5XT09hMHl6U09OSDRKQThhTUFENXVsaUJDcDB3dVJ6b0t4cy9jc21ENVdrTHJWeDRxQ3h4UjRjTzE0UE5HVFcwXG5kSGdnQUNCREpnSTY0OW1TbzA5UTZzWDJweGIwck9GK1ZFN2hBN1UzdEl2bGxjeW82OUNNdjdzdVUrLzZMT2RQXG5KMTExTFlCNy93S0JnUURDNVVadkxjeCt6UWJhWTI5NS9YbVFiWnp4aEVwZ0Zpb3pIQk1hdklCMlU1TXZOUVhSXG5GeVBFK0dGV0xaWHMzY3NsN2JJRWQ4TGV1eWJ3TU9yUkpablpPTFpJVmJjY0liQVJMb1I3TkM1Mk1FbU1tY1V5XG5EdDYxbGdqWm9mMjFiOW5oSXVWUjJZUGhnaFFkUjVkamVYU1hnalJWSjNxMStIb0NxRTFIYzVCZ1d3S0JnUUNXXG5XSldnUmlMUFoyYi9OeU11aFZLaDE1RzZUOTMxSDRMLzYrRW5iVzVHTmlSbDdqcllabDdVMTFnRUtFVzZlTDhEXG53VUh1RHdGdlJ1SHMybzhTUGFJeWk2cGhsNG5LSEdXQWNYVkY0ekE3T1J6QVNTUUtiNkphUklzeVhqM1R3NDdaXG5NRzNmd000R0FlY0RvTjd1VkxYbk9TL1lSRDI3ay91RmZlU0tDSWNVK3dLQmdHbTIzNlBNVzRsUWIzaTJyZ0lhXG5sT3d1bHoraEJoTlJVUXBoRFZLd1lYS1BlTHdvL2crZzFybnU5MVRCb2JyYnRRWFFabWE0Z002emlHOTVzMXlUXG5NanR2aHJyVmNOa1cyNXlMNmFzRlNTLytlZXZXcjJvQTVubXAzUHNMNG4rTFhYaWc1QzFtTEVuQlFFZVpoSmdKXG5EQzdlTEpibng4UFZmY3VWM0s4UStBMUdcbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJhY2Nlcy1nY3ItaW1hZ2VzQG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjEwODkwNDI2NzczMzQ4NzgyNjk0OSIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvYWNjZXMtZ2NyLWltYWdlcyU0MG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9Cg==

#- name: ssh-git-pull
#  pull: if-not-exists
#  image: appleboy/drone-ssh
#  environment:
#    ENV:
#      from_secret: env
#  settings:
#    host: 35.229.238.232
#    username: alvin
#    port: 22
#    key:
#      from_secret: privateKey
#    envs: [ENV]
#    script:
#      - cd /var/www/html/laravel_drone_test
#      - sudo git pull
#      - echo $${ENV}
#      - echo $${ENV} | sudo tee .env


#- name: build-nginx-image
#  pull: if-not-exists
#  image: plugins/docker
#  settings:
#    registry: registry.hub.docker.com
#    repo: registry.hub.docker.com/virtualorz/docker_compose_nginx_build
#    dockerfile: dockerfiles/dockerfile_for_nginx/Dockerfile
#    auto_tag: true
#    username: virtualorz
#    password: 2uxirgil

#- name: build-php-image
#  pull: if-not-exists
#  image: plugins/docker
#  settings:
#    registry: registry.hub.docker.com
#    repo: registry.hub.docker.com/virtualorz/dev_compose_php73_laravel_build
#    dockerfile: dockerfiles/dockerfile_for_laravel/Dockerfile
#    auto_tag: true
#    username: virtualorz
#    password: 2uxirgil
