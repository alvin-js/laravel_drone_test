---
kind: pipeline
type: docker
name: test

platform:
  os: linux
  arch: amd64

steps:
  - name: publish_nginx
    image: plugins/gcr
    settings:
      registry: asia.gcr.io
      repo: nodal-wall-248502/docker_compose_nginx_build
      tags: latest
      dockerfile: dockerfiles/dockerfile_for_nginx/Dockerfile
      json_key: >
        {
          "type": "service_account",
          "project_id": "nodal-wall-248502",
          "private_key_id": "a97b35cc2077b77518f89e62a012cf28c46d5611",
          "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDUvDIErd4/QT5U\npZnao4D2qD4Qm55OXM4ZEwAucwiMdxZF2XHBhb1UO7c0JTdny+jwXD1q4Sp+nRrU\nI2x8zSHvoSOKouumt9pjleCM8HpW7rYtijHzBAg4q1fyJvbvcqds8udQRLgohFvi\n2Op5QrG2Q7ar0Uc9zPf6KHCvLjLpqDKpJ4AtzVkGUxXCiHK1trXeFWHLvrGIk5zm\nuPjZZtDHmzjt7+SzRXbX77VjmAtupMpwKS6dLWyg7ISTv5EARRAyJE56hFPtXOTn\nAb6w47oW/PZgt91Q6OulzmVbOTLcEtp8Lf0h2eKWPf3P05yKGemgENccPF+iwBi5\n9mp5aY61AgMBAAECggEAX/0GyKu3I22J9WG/eTLbZvBlCNNe69beO9wh8dN/4Pl+\n+Ed0F7EDy7UiJgpA5LnSQloscERnCzhSObQ+KFXa4SghRFXc5J4CkXq4FoAPg5g0\nZXn8rb19BCz0AtRoCYT/XJ6Bluta+RU37LSZn9tjGm2VSBOnBJCut5Z1ueWrnVev\neq6G/4sO20XlChlsFSw53cbyRYMGh8uBLn/+HrKUW6E75sztwY3OIqXoMS7vI8Qr\nr1D4+1ST2/lFPPOJsDzCjmcxk0R9FisQuhURjNucA3AXHlwcHlkU50eS35k01/wN\nY6iJQijJ4VO7W0z0xVDpYXSaoBaptM3NXJRqw3AiRQKBgQD4VwztrfYyll+7Poy3\nfV9KdkdSMnW3V+V8rdHvBni2/MmEUFwDB+7l+/CkhqC7FlLPzvuYiir8oWTVNYGs\n2blircG9ExXa0rtkPeL9mWe8GkyLzObJ84fUQ0QdBap58V+GdP1pF0cYuOgZvcts\nsc+notfYMz8Bahys2FC2IqbFSwKBgQDbTAAebIjXywaYffQ3IhKaiyUbowoBRfNQ\nWOOa0yzSONH4JA8aMAD5uliBCp0wuRzoKxs/csmD5WkLrVx4qCxxR4cO14PNGTW0\ndHggACBDJgI649mSo09Q6sX2pxb0rOF+VE7hA7U3tIvllcyo69CMv7suU+/6LOdP\nJ111LYB7/wKBgQDC5UZvLcx+zQbaY295/XmQbZzxhEpgFiozHBMavIB2U5MvNQXR\nFyPE+GFWLZXs3csl7bIEd8LeuybwMOrRJZnZOLZIVbccIbARLoR7NC52MEmMmcUy\nDt61lgjZof21b9nhIuVR2YPhghQdR5djeXSXgjRVJ3q1+HoCqE1Hc5BgWwKBgQCW\nWJWgRiLPZ2b/NyMuhVKh15G6T931H4L/6+EnbW5GNiRl7jrYZl7U11gEKEW6eL8D\nwUHuDwFvRuHs2o8SPaIyi6phl4nKHGWAcXVF4zA7ORzASSQKb6JaRIsyXj3Tw47Z\nMG3fwM4GAecDoN7uVLXnOS/YRD27k/uFfeSKCIcU+wKBgGm236PMW4lQb3i2rgIa\nlOwulz+hBhNRUQphDVKwYXKPeLwo/g+g1rnu91TBobrbtQXQZma4gM6ziG95s1yT\nMjtvhrrVcNkW25yL6asFSS/+eevWr2oA5nmp3PsL4n+LXXig5C1mLEnBQEeZhJgJ\nDC7eLJbnx8PVfcuV3K8Q+A1G\n-----END PRIVATE KEY-----\n",
          "client_email": "acces-gcr-images@nodal-wall-248502.iam.gserviceaccount.com",
          "client_id": "108904267733487826949",
          "auth_uri": "https://accounts.google.com/o/oauth2/auth",
          "token_uri": "https://oauth2.googleapis.com/token",
          "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
          "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/acces-gcr-images%40nodal-wall-248502.iam.gserviceaccount.com"
        }

  - name: publish_php
    image: plugins/gcr
    settings:
      registry: asia.gcr.io
      repo: nodal-wall-248502/docker_compose_php73_laravel_build
      tags: latest
      dockerfile: dockerfiles/dockerfile_for_laravel/Dockerfile
      json_key: >
        {
          "type": "service_account",
          "project_id": "nodal-wall-248502",
          "private_key_id": "a97b35cc2077b77518f89e62a012cf28c46d5611",
          "private_key": "-----BEGIN PRIVATE KEY-----\nMIIEvgIBADANBgkqhkiG9w0BAQEFAASCBKgwggSkAgEAAoIBAQDUvDIErd4/QT5U\npZnao4D2qD4Qm55OXM4ZEwAucwiMdxZF2XHBhb1UO7c0JTdny+jwXD1q4Sp+nRrU\nI2x8zSHvoSOKouumt9pjleCM8HpW7rYtijHzBAg4q1fyJvbvcqds8udQRLgohFvi\n2Op5QrG2Q7ar0Uc9zPf6KHCvLjLpqDKpJ4AtzVkGUxXCiHK1trXeFWHLvrGIk5zm\nuPjZZtDHmzjt7+SzRXbX77VjmAtupMpwKS6dLWyg7ISTv5EARRAyJE56hFPtXOTn\nAb6w47oW/PZgt91Q6OulzmVbOTLcEtp8Lf0h2eKWPf3P05yKGemgENccPF+iwBi5\n9mp5aY61AgMBAAECggEAX/0GyKu3I22J9WG/eTLbZvBlCNNe69beO9wh8dN/4Pl+\n+Ed0F7EDy7UiJgpA5LnSQloscERnCzhSObQ+KFXa4SghRFXc5J4CkXq4FoAPg5g0\nZXn8rb19BCz0AtRoCYT/XJ6Bluta+RU37LSZn9tjGm2VSBOnBJCut5Z1ueWrnVev\neq6G/4sO20XlChlsFSw53cbyRYMGh8uBLn/+HrKUW6E75sztwY3OIqXoMS7vI8Qr\nr1D4+1ST2/lFPPOJsDzCjmcxk0R9FisQuhURjNucA3AXHlwcHlkU50eS35k01/wN\nY6iJQijJ4VO7W0z0xVDpYXSaoBaptM3NXJRqw3AiRQKBgQD4VwztrfYyll+7Poy3\nfV9KdkdSMnW3V+V8rdHvBni2/MmEUFwDB+7l+/CkhqC7FlLPzvuYiir8oWTVNYGs\n2blircG9ExXa0rtkPeL9mWe8GkyLzObJ84fUQ0QdBap58V+GdP1pF0cYuOgZvcts\nsc+notfYMz8Bahys2FC2IqbFSwKBgQDbTAAebIjXywaYffQ3IhKaiyUbowoBRfNQ\nWOOa0yzSONH4JA8aMAD5uliBCp0wuRzoKxs/csmD5WkLrVx4qCxxR4cO14PNGTW0\ndHggACBDJgI649mSo09Q6sX2pxb0rOF+VE7hA7U3tIvllcyo69CMv7suU+/6LOdP\nJ111LYB7/wKBgQDC5UZvLcx+zQbaY295/XmQbZzxhEpgFiozHBMavIB2U5MvNQXR\nFyPE+GFWLZXs3csl7bIEd8LeuybwMOrRJZnZOLZIVbccIbARLoR7NC52MEmMmcUy\nDt61lgjZof21b9nhIuVR2YPhghQdR5djeXSXgjRVJ3q1+HoCqE1Hc5BgWwKBgQCW\nWJWgRiLPZ2b/NyMuhVKh15G6T931H4L/6+EnbW5GNiRl7jrYZl7U11gEKEW6eL8D\nwUHuDwFvRuHs2o8SPaIyi6phl4nKHGWAcXVF4zA7ORzASSQKb6JaRIsyXj3Tw47Z\nMG3fwM4GAecDoN7uVLXnOS/YRD27k/uFfeSKCIcU+wKBgGm236PMW4lQb3i2rgIa\nlOwulz+hBhNRUQphDVKwYXKPeLwo/g+g1rnu91TBobrbtQXQZma4gM6ziG95s1yT\nMjtvhrrVcNkW25yL6asFSS/+eevWr2oA5nmp3PsL4n+LXXig5C1mLEnBQEeZhJgJ\nDC7eLJbnx8PVfcuV3K8Q+A1G\n-----END PRIVATE KEY-----\n",
          "client_email": "acces-gcr-images@nodal-wall-248502.iam.gserviceaccount.com",
          "client_id": "108904267733487826949",
          "auth_uri": "https://accounts.google.com/o/oauth2/auth",
          "token_uri": "https://oauth2.googleapis.com/token",
          "auth_provider_x509_cert_url": "https://www.googleapis.com/oauth2/v1/certs",
          "client_x509_cert_url": "https://www.googleapis.com/robot/v1/metadata/x509/acces-gcr-images%40nodal-wall-248502.iam.gserviceaccount.com"
        }


#- name: ssh-git-pull
#  pull: if-not-exists
#  image: appleboy/drone-ssh
#  environment:
#    ENV:
#      from_secret: env
#  settings:
#    host: 35.229.238.232
#    username: alvin
#    port: 22
#    key:
#      from_secret: privateKey
#    envs: [ENV]
#    script:
#      - cd /var/www/html/laravel_drone_test
#      - sudo git pull
#      - echo $${ENV}
#      - echo $${ENV} | sudo tee .env


#- name: build-nginx-image
#  pull: if-not-exists
#  image: plugins/docker
#  settings:
#    registry: registry.hub.docker.com
#    repo: registry.hub.docker.com/virtualorz/docker_compose_nginx_build
#    dockerfile: dockerfiles/dockerfile_for_nginx/Dockerfile
#    auto_tag: true
#    username: virtualorz
#    password: 2uxirgil

#- name: build-php-image
#  pull: if-not-exists
#  image: plugins/docker
#  settings:
#    registry: registry.hub.docker.com
#    repo: registry.hub.docker.com/virtualorz/dev_compose_php73_laravel_build
#    dockerfile: dockerfiles/dockerfile_for_laravel/Dockerfile
#    auto_tag: true
#    username: virtualorz
#    password: 2uxirgil
