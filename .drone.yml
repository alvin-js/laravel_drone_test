---
kind: pipeline
type: docker
name: test

platform:
  os: linux
  arch: amd64

steps:
  - name: publish_nginx
    image: plugins/gcr
    settings:
      registry: asia.gcr.io
      repo: nodal-wall-248502/docker_compose_nginx_build
      tags: latest
      dockerfile: dockerfiles/dockerfile_for_nginx/Dockerfile
      json_key: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibm9kYWwtd2FsbC0yNDg1MDIiLAogICJwcml2YXRlX2tleV9pZCI6ICJhMWY4MzY3ZjQ4MTA4NDRjZTA4NzBiOTY2ODgwYzA1ZDI0NzU5M2I0IiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdkFJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLWXdnZ1NpQWdFQUFvSUJBUUM3aDBkSk1YWEF6U3hVXG5adzRZUERyRWx5ZGxsTUtKZm5xTHpoM3M2VWw2OVBTbXBOTWdtUXNpcVNrK1lwUU5Dc0FBdjJFZ2g0ZnhFMFU2XG4xclZGMklvRUh1c1BUTk9MUjdUZFZBTVhJL2JPNXRrMEFjRXRkKzFPQkcxUkFXdnFmUUtmTjlnOXY0S3hXV093XG5jSDZhK3hzeUdkSjZJa3I2NUF2TjhnZG9FdnNjclZYcFZ2RXFnZEJLZCtRbHFsYXFrQ0RzOTExazRpekthaHVzXG5wMkk5ZTIxaWZFV1ROYnc1cCtGU0U0aEhQeWFoT1dOQTZHRmFVMkhCZWpMb2U2bzZUNU56aXR4amY5QUFENFREXG5aK2hZR2pBWlgrdzh2cWsrY3A1TFk2SlhxenpQcXNZWUQ2a0NicmJxdEd1Z3AxYjlTa2UzSGdiUUVoTW5zREFNXG4xSk93clpXTEFnTUJBQUVDZ2dFQUY1NzNsTG1kS25idGtZZ1ZsMm5td1NLRS9OK2JEWFNYL1FvdWJNd0p6R29VXG5jdlVwL3Q0b0wrcDgzblhPVGtJL1l4aTRKRC9PR01pam5NQzB2cUtDNS9mNUJjbFlrQit0SVgvV2o5Q2c0dmppXG4vUkVIZ3pHcSszdkZSVUhYbFFiQUVNd1krZFlvb1N3d1NXWXlIRlZxM0lteUlGNDNjWmpOLzlmdnBPVlhLZ3BZXG5LRnY2UE55cjdaRDBLakEzbEhXYThvNkd2T1NBbUx6b2RQSkNGWlRnUWg4dVZoNlBXQjRaYUNYMkZ3REtZeFZMXG5uMHhJWVdIcjh6a2xDMndwZXJsYUZaTGp5MXRIZVloVEhVVSs1Z1czQzBpYkxieXZHVndkcWVKcTcyM3ZqcVJkXG5SZ0I5L3o0OWRUZEdPSWt0YXBTMm02WHZyMVplcWduczVHb1h0bkNaUVFLQmdRRGJSOW40Wm5Iam55SDdORnNPXG43N0h1QlBycFVrRGVnMzNrWDViQUpqUEE4a1V3N3dzZ1RyZWtoQUFGdjVQNHd5Y2Nad1Iwb3k2ZFB3b2ptWE5zXG4zdWV4RXFGcGk5eHNzNjRiVTc2NkJJaU1aTzUzeXlKWFdGdzUvQko1czJJcjJXQVdPTXhmMjArRlNRbkFETUpNXG45NnUwNitQNFlEU0J2cU1QUWNtNG1mbE02d0tCZ1FEYTdrUzZ0NEZmQUZkLzl0bFIwWmY1NXVyRWlONlpzSWhDXG5pQjZtUUY4WG5UcnhYek0zUTYzN0RZdWNMWFc3OTFNWmxrSFdaY0tUS215VUJUZm9TOGYrc2NKOG1uTkRaTE1qXG5YTnRTUXEzN1g5ckpYNmpDdDZBazdCdlRGZkpUMWdMZDhhRUFwL2VoNlBodS9MT0Q1NWlrOUpSS0lDb0sxcmgvXG45UGh1V0lneDRRS0JnSDlnNzdlaUd3cDB5RkthaVVMVjduQXJxRzJkQUYzQjJJR3ZIVzBsUSs4VFRTb3QwakxFXG5SMTFqNkhkdVlGQ2pYTGJkQ1BPUVQyVzgxdkR6Rk4vclpIK3lLTjJkQjBDRjU5K3IrQ0VxdlArQktoMmdmS1JzXG5pYmFOUFZaQTVBaEF6OVpZekMvcXYvalhBcmp6TUhOeGMrYzNHRWlSNmk1c1JXQjVnT3FoVnZaZEFvR0FlOWRzXG5hWEtFYkFqMWRoMWNzVHV1akY1alR1bGRnZktxSVhoK1hlenIzWi9EUitaaVFsQzJpZDBQckRqSzhKam5HUUkyXG5HK0ZVUDRzd0FFc3paT1A1TGNuQUNsd1Q5M3R2R2dIY3pwdUpiemk1dWsreVZ2TW9VN3A3d3R3WFIvVTNpZlMwXG43bm9WU2pGTzF2bDdVcElmZHJBamNncmZ2V0hZM0FqbXZ3UzFoZ0VDZ1lCNGcwdmZBejlPSnR5eWRBbW52UUlMXG5lVUZ1VUpNbWIxRGVNQkNyTkFEQno4ZFhkQ3FjUEhLZ0tYTndSRGFrNjAya2gwSHFyZ3B3NGxSREdHR2tkVHhBXG5ZNklnMkVTaS9OSGcyd3dFWUtQNDMxY1lYRHZSb1hlTjN6MUh3c0ZPb1VTRXd6QVU1L1lBQ2pXWmx5bXpydHpCXG5mU3NEdDhHL3h4ZVFPYndlaUo0cnlRPT1cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJhY2Nlc3MtZ2NyQG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjExMzI0NTk5MzY3MzUxMjU3NjUzMCIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvYWNjZXNzLWdjciU0MG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9
  - name: publish_php
    image: plugins/gcr
    settings:
      registry: asia.gcr.io
      repo: nodal-wall-248502/docker_compose_php73_laravel_build
      tags: latest
      dockerfile: dockerfiles/dockerfile_for_laravel/Dockerfile
      json_key: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibm9kYWwtd2FsbC0yNDg1MDIiLAogICJwcml2YXRlX2tleV9pZCI6ICJhMWY4MzY3ZjQ4MTA4NDRjZTA4NzBiOTY2ODgwYzA1ZDI0NzU5M2I0IiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdkFJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLWXdnZ1NpQWdFQUFvSUJBUUM3aDBkSk1YWEF6U3hVXG5adzRZUERyRWx5ZGxsTUtKZm5xTHpoM3M2VWw2OVBTbXBOTWdtUXNpcVNrK1lwUU5Dc0FBdjJFZ2g0ZnhFMFU2XG4xclZGMklvRUh1c1BUTk9MUjdUZFZBTVhJL2JPNXRrMEFjRXRkKzFPQkcxUkFXdnFmUUtmTjlnOXY0S3hXV093XG5jSDZhK3hzeUdkSjZJa3I2NUF2TjhnZG9FdnNjclZYcFZ2RXFnZEJLZCtRbHFsYXFrQ0RzOTExazRpekthaHVzXG5wMkk5ZTIxaWZFV1ROYnc1cCtGU0U0aEhQeWFoT1dOQTZHRmFVMkhCZWpMb2U2bzZUNU56aXR4amY5QUFENFREXG5aK2hZR2pBWlgrdzh2cWsrY3A1TFk2SlhxenpQcXNZWUQ2a0NicmJxdEd1Z3AxYjlTa2UzSGdiUUVoTW5zREFNXG4xSk93clpXTEFnTUJBQUVDZ2dFQUY1NzNsTG1kS25idGtZZ1ZsMm5td1NLRS9OK2JEWFNYL1FvdWJNd0p6R29VXG5jdlVwL3Q0b0wrcDgzblhPVGtJL1l4aTRKRC9PR01pam5NQzB2cUtDNS9mNUJjbFlrQit0SVgvV2o5Q2c0dmppXG4vUkVIZ3pHcSszdkZSVUhYbFFiQUVNd1krZFlvb1N3d1NXWXlIRlZxM0lteUlGNDNjWmpOLzlmdnBPVlhLZ3BZXG5LRnY2UE55cjdaRDBLakEzbEhXYThvNkd2T1NBbUx6b2RQSkNGWlRnUWg4dVZoNlBXQjRaYUNYMkZ3REtZeFZMXG5uMHhJWVdIcjh6a2xDMndwZXJsYUZaTGp5MXRIZVloVEhVVSs1Z1czQzBpYkxieXZHVndkcWVKcTcyM3ZqcVJkXG5SZ0I5L3o0OWRUZEdPSWt0YXBTMm02WHZyMVplcWduczVHb1h0bkNaUVFLQmdRRGJSOW40Wm5Iam55SDdORnNPXG43N0h1QlBycFVrRGVnMzNrWDViQUpqUEE4a1V3N3dzZ1RyZWtoQUFGdjVQNHd5Y2Nad1Iwb3k2ZFB3b2ptWE5zXG4zdWV4RXFGcGk5eHNzNjRiVTc2NkJJaU1aTzUzeXlKWFdGdzUvQko1czJJcjJXQVdPTXhmMjArRlNRbkFETUpNXG45NnUwNitQNFlEU0J2cU1QUWNtNG1mbE02d0tCZ1FEYTdrUzZ0NEZmQUZkLzl0bFIwWmY1NXVyRWlONlpzSWhDXG5pQjZtUUY4WG5UcnhYek0zUTYzN0RZdWNMWFc3OTFNWmxrSFdaY0tUS215VUJUZm9TOGYrc2NKOG1uTkRaTE1qXG5YTnRTUXEzN1g5ckpYNmpDdDZBazdCdlRGZkpUMWdMZDhhRUFwL2VoNlBodS9MT0Q1NWlrOUpSS0lDb0sxcmgvXG45UGh1V0lneDRRS0JnSDlnNzdlaUd3cDB5RkthaVVMVjduQXJxRzJkQUYzQjJJR3ZIVzBsUSs4VFRTb3QwakxFXG5SMTFqNkhkdVlGQ2pYTGJkQ1BPUVQyVzgxdkR6Rk4vclpIK3lLTjJkQjBDRjU5K3IrQ0VxdlArQktoMmdmS1JzXG5pYmFOUFZaQTVBaEF6OVpZekMvcXYvalhBcmp6TUhOeGMrYzNHRWlSNmk1c1JXQjVnT3FoVnZaZEFvR0FlOWRzXG5hWEtFYkFqMWRoMWNzVHV1akY1alR1bGRnZktxSVhoK1hlenIzWi9EUitaaVFsQzJpZDBQckRqSzhKam5HUUkyXG5HK0ZVUDRzd0FFc3paT1A1TGNuQUNsd1Q5M3R2R2dIY3pwdUpiemk1dWsreVZ2TW9VN3A3d3R3WFIvVTNpZlMwXG43bm9WU2pGTzF2bDdVcElmZHJBamNncmZ2V0hZM0FqbXZ3UzFoZ0VDZ1lCNGcwdmZBejlPSnR5eWRBbW52UUlMXG5lVUZ1VUpNbWIxRGVNQkNyTkFEQno4ZFhkQ3FjUEhLZ0tYTndSRGFrNjAya2gwSHFyZ3B3NGxSREdHR2tkVHhBXG5ZNklnMkVTaS9OSGcyd3dFWUtQNDMxY1lYRHZSb1hlTjN6MUh3c0ZPb1VTRXd6QVU1L1lBQ2pXWmx5bXpydHpCXG5mU3NEdDhHL3h4ZVFPYndlaUo0cnlRPT1cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJhY2Nlc3MtZ2NyQG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjExMzI0NTk5MzY3MzUxMjU3NjUzMCIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvYWNjZXNzLWdjciU0MG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9

#- name: ssh-git-pull
#  pull: if-not-exists
#  image: appleboy/drone-ssh
#  environment:
#    ENV:
#      from_secret: env
#  settings:
#    host: 35.229.238.232
#    username: alvin
#    port: 22
#    key:
#      from_secret: privateKey
#    envs: [ENV]
#    script:
#      - cd /var/www/html/laravel_drone_test
#      - sudo git pull
#      - echo $${ENV}
#      - echo $${ENV} | sudo tee .env


#- name: build-nginx-image
#  pull: if-not-exists
#  image: plugins/docker
#  settings:
#    registry: registry.hub.docker.com
#    repo: registry.hub.docker.com/virtualorz/docker_compose_nginx_build
#    dockerfile: dockerfiles/dockerfile_for_nginx/Dockerfile
#    auto_tag: true
#    username: virtualorz
#    password: 2uxirgil

#- name: build-php-image
#  pull: if-not-exists
#  image: plugins/docker
#  settings:
#    registry: registry.hub.docker.com
#    repo: registry.hub.docker.com/virtualorz/dev_compose_php73_laravel_build
#    dockerfile: dockerfiles/dockerfile_for_laravel/Dockerfile
#    auto_tag: true
#    username: virtualorz
#    password: 2uxirgil
