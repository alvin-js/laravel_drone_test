---
kind: pipeline
type: docker
name: test

platform:
  os: linux
  arch: amd64

steps:
  - name: publish_nginx
      image: plugins/gcr
      settings:
        registry: asia.gcr.io
        repo: nodal-wall-248502/docker_compose_nginx_build
        tags: latest
        dockerfile: dockerfiles/dockerfile_for_nginx/Dockerfile
        json_key: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibm9kYWwtd2FsbC0yNDg1MDIiLAogICJwcml2YXRlX2tleV9pZCI6ICI2ZWJhMDU3YjdkYzAzYzdmNjgzNjEzYzA1ZDJiYzRkZjA4ZGU3OTljIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdlFJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLY3dnZ1NqQWdFQUFvSUJBUURENmN5Y2lzRzFFMDliXG5QT3hrbTluL2hTaHgrMHJBOW1RYk1CNXlReG8vdGsxaDE0SFhDSWUxWWo1emlWY2dEN1UyZnM3Mi9YMU1KS3BMXG5INHlZYlVCcFRHQkdCbG8xS2NYMmpYdDhVWWc1SWEzcjNwV3psakI5MVZ3R1RqZXJYYWVTNlpQU2kyY2E0ekNiXG41Y3M0anFmd1puZW94ZFE4OUxBWnVIR3BFaWFxMGtCM0tsTFZLRlI5T1VCYmpiL1cxd0FzbElyenM1cXRUMGV6XG5RZThWVDdjWHUyN3prWnQ2aDdYTytHVy9OWUlVc2tFdHBoM1M5OWhBV2tLcXhqT0JnWTJDM2hnWE8rdmdyYTRJXG5tcnY0eUhiK1lPRVBZM3haVkNaTzhZV1RXK3dkZEF1QkdWV09ia1MwZXlXa2lzRG1PUm51b1g4bDFqdlRuY09pXG4zUXZNREpabEFnTUJBQUVDZ2dFQURRdnB6Z0dlTldmTUlNQlFOeGI3T24xQjhlMDd6NFBaQU1mVjVJMW13Y0xBXG5mbmt5aUFFUHdJV0NzU3VwTzFVRnlxanIzQjQwdjQyd01DdmNCTFBwMW9QNU9WQ1NVS05haFRrV0lIT2NNR25NXG53ajROYkJYZXRDZmNPLzN1STh4VjEzNXA2TEI5MzVnczZZVGJ0ckFtcTVJTXBVR2ZYbEVtZjdWU1pHR2dENVN1XG5WWFhZbWpjMkQrZFVrUTZLa3VOQUlQR0J5VnpHd3N4SVpuWFQwWTYzL1gydVRRbnhHbVhacTZ2OXdNMGtZWFdnXG5tVVpCcENyTTZTNWNyTExLVlVXK0Nzc1VIVVladEdmaGxGbElhK1diRFYyYmdsdmY5TjBzM2kzbHdhZ0Y2Z2IzXG50NDV0RzVwMlpzbkVadS9Ib1RSMmtJN1RvdERneWhjbTBVY3Zja296b1FLQmdRRGlBSmhMUDZ2MGdzOWFKRG5yXG55VDFnT3dROE9Ia1lyVVlCMm1YTnBVYjZqSnZtdnRhc243Z0N5bnM0SW5LdDlNYjVOc3NHNTdMT2FOclRYNjBKXG43UnRUK0krMjBzL3lEekM4aE0yRFdROE00bkx1ZGwwOUkzRDhrT3BMQmtOYTdrcmJmemd1NmFIQTFCMnJOcW5nXG41SE4zMjA3WStYQ2RXQzhsY3ZqdjdWRFFIUUtCZ1FEZDZzeVE0S01EaHcwRVp1Um1zTldJVUJuOTk4bmI2RnNNXG5qZExuc2o4S1k1Ris3MTBOc0VTWmFZNUgreStXanRIckRvL1dULzlaVjlMdW5ZRUs2dlFaSzBzM3hxRGR6eUNBXG5HT1dpMTN4NCtIczRwL1dnM3VRUEEwdjFrNml4bVdWc2pNK0l5NU8zRE14RlRaWXd6R2h3cjA4S1E0UlI2cXRhXG5hYVlWek93YzZRS0JnUURBNDk4WHduVkNFRzluTVNvYVd6eStLRUM2SVQwQjJjbTVoU3lFY3o3OFV3d3d5Y3F4XG50UFE1dFpXcldJTm1nMWRibHU5N3FqK0xPaVVpYVROb0dHM05vb1VPZGlreklOSG81TFAvR2dEbGIxVEd3RkZlXG5BQ1RMKytkc055RS90OGcrUlB1djFvbk82WHVWQ09lKzRWekgvRzcwY3hreHdmVWpVbGl6ZG1vVjVRS0JnRHo2XG5QNnV2amh0eUNJbWxIQzE3ZWJFekVYRlBuUS9vRU55cU84R2VvT1BoNkNEUTlPakYvcE9KQmFlUnhjbkJCTDFxXG5DdXdBbjFHVmFFaFl6eFNJNnZuZmc1T1g2S3dLTmd2OHkxeXJpWEJVRnNmQ255UE5HeTFrNG9KZ1NJSkVmRElQXG5ueGNmbVQ4N0xRWCtBNzcwNjkzS3poVXI2RGY2RzR1RWJEYWhVRi9CQW9HQVBCVVpJVXltUDNnbXpjTmxqdG9UXG5maGNRYi9idEduaFR3ZVF5OURxVmliRWJvWFpEVjZZZndOTXMwRXhmUXhtQ2dSN01TRXlTZDB3QWVwNTlCbXdyXG52N2RWUk5kM2l5Q2ZnVkRHQlVIV2JRalZKTlBteDNLK3dVLzZKcno2K25jVldQVm81cklxdnNUaTl3VXJ6U0pkXG5NbThzNmE4N2VYMHErZURsNWtSVzEydz1cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJhY2Nlc3MtZ2NyQG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjExNTMyMjU2NzgyNDY1NjA3OTgxNCIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvYWNjZXNzLWdjciU0MG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9Cg==

  - name: publish_php
      image: plugins/gcr
      settings:
        registry: asia.gcr.io
        repo: nodal-wall-248502/docker_compose_php73_laravel_build
        tags: latest
        dockerfile: dockerfiles/dockerfile_for_laravel/Dockerfile
        json_key: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibm9kYWwtd2FsbC0yNDg1MDIiLAogICJwcml2YXRlX2tleV9pZCI6ICI2ZWJhMDU3YjdkYzAzYzdmNjgzNjEzYzA1ZDJiYzRkZjA4ZGU3OTljIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdlFJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLY3dnZ1NqQWdFQUFvSUJBUURENmN5Y2lzRzFFMDliXG5QT3hrbTluL2hTaHgrMHJBOW1RYk1CNXlReG8vdGsxaDE0SFhDSWUxWWo1emlWY2dEN1UyZnM3Mi9YMU1KS3BMXG5INHlZYlVCcFRHQkdCbG8xS2NYMmpYdDhVWWc1SWEzcjNwV3psakI5MVZ3R1RqZXJYYWVTNlpQU2kyY2E0ekNiXG41Y3M0anFmd1puZW94ZFE4OUxBWnVIR3BFaWFxMGtCM0tsTFZLRlI5T1VCYmpiL1cxd0FzbElyenM1cXRUMGV6XG5RZThWVDdjWHUyN3prWnQ2aDdYTytHVy9OWUlVc2tFdHBoM1M5OWhBV2tLcXhqT0JnWTJDM2hnWE8rdmdyYTRJXG5tcnY0eUhiK1lPRVBZM3haVkNaTzhZV1RXK3dkZEF1QkdWV09ia1MwZXlXa2lzRG1PUm51b1g4bDFqdlRuY09pXG4zUXZNREpabEFnTUJBQUVDZ2dFQURRdnB6Z0dlTldmTUlNQlFOeGI3T24xQjhlMDd6NFBaQU1mVjVJMW13Y0xBXG5mbmt5aUFFUHdJV0NzU3VwTzFVRnlxanIzQjQwdjQyd01DdmNCTFBwMW9QNU9WQ1NVS05haFRrV0lIT2NNR25NXG53ajROYkJYZXRDZmNPLzN1STh4VjEzNXA2TEI5MzVnczZZVGJ0ckFtcTVJTXBVR2ZYbEVtZjdWU1pHR2dENVN1XG5WWFhZbWpjMkQrZFVrUTZLa3VOQUlQR0J5VnpHd3N4SVpuWFQwWTYzL1gydVRRbnhHbVhacTZ2OXdNMGtZWFdnXG5tVVpCcENyTTZTNWNyTExLVlVXK0Nzc1VIVVladEdmaGxGbElhK1diRFYyYmdsdmY5TjBzM2kzbHdhZ0Y2Z2IzXG50NDV0RzVwMlpzbkVadS9Ib1RSMmtJN1RvdERneWhjbTBVY3Zja296b1FLQmdRRGlBSmhMUDZ2MGdzOWFKRG5yXG55VDFnT3dROE9Ia1lyVVlCMm1YTnBVYjZqSnZtdnRhc243Z0N5bnM0SW5LdDlNYjVOc3NHNTdMT2FOclRYNjBKXG43UnRUK0krMjBzL3lEekM4aE0yRFdROE00bkx1ZGwwOUkzRDhrT3BMQmtOYTdrcmJmemd1NmFIQTFCMnJOcW5nXG41SE4zMjA3WStYQ2RXQzhsY3ZqdjdWRFFIUUtCZ1FEZDZzeVE0S01EaHcwRVp1Um1zTldJVUJuOTk4bmI2RnNNXG5qZExuc2o4S1k1Ris3MTBOc0VTWmFZNUgreStXanRIckRvL1dULzlaVjlMdW5ZRUs2dlFaSzBzM3hxRGR6eUNBXG5HT1dpMTN4NCtIczRwL1dnM3VRUEEwdjFrNml4bVdWc2pNK0l5NU8zRE14RlRaWXd6R2h3cjA4S1E0UlI2cXRhXG5hYVlWek93YzZRS0JnUURBNDk4WHduVkNFRzluTVNvYVd6eStLRUM2SVQwQjJjbTVoU3lFY3o3OFV3d3d5Y3F4XG50UFE1dFpXcldJTm1nMWRibHU5N3FqK0xPaVVpYVROb0dHM05vb1VPZGlreklOSG81TFAvR2dEbGIxVEd3RkZlXG5BQ1RMKytkc055RS90OGcrUlB1djFvbk82WHVWQ09lKzRWekgvRzcwY3hreHdmVWpVbGl6ZG1vVjVRS0JnRHo2XG5QNnV2amh0eUNJbWxIQzE3ZWJFekVYRlBuUS9vRU55cU84R2VvT1BoNkNEUTlPakYvcE9KQmFlUnhjbkJCTDFxXG5DdXdBbjFHVmFFaFl6eFNJNnZuZmc1T1g2S3dLTmd2OHkxeXJpWEJVRnNmQ255UE5HeTFrNG9KZ1NJSkVmRElQXG5ueGNmbVQ4N0xRWCtBNzcwNjkzS3poVXI2RGY2RzR1RWJEYWhVRi9CQW9HQVBCVVpJVXltUDNnbXpjTmxqdG9UXG5maGNRYi9idEduaFR3ZVF5OURxVmliRWJvWFpEVjZZZndOTXMwRXhmUXhtQ2dSN01TRXlTZDB3QWVwNTlCbXdyXG52N2RWUk5kM2l5Q2ZnVkRHQlVIV2JRalZKTlBteDNLK3dVLzZKcno2K25jVldQVm81cklxdnNUaTl3VXJ6U0pkXG5NbThzNmE4N2VYMHErZURsNWtSVzEydz1cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJhY2Nlc3MtZ2NyQG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjExNTMyMjU2NzgyNDY1NjA3OTgxNCIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvYWNjZXNzLWdjciU0MG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9Cg==

#- name: ssh-git-pull
#  pull: if-not-exists
#  image: appleboy/drone-ssh
#  environment:
#    ENV:
#      from_secret: env
#  settings:
#    host: 35.229.238.232
#    username: alvin
#    port: 22
#    key:
#      from_secret: privateKey
#    envs: [ENV]
#    script:
#      - cd /var/www/html/laravel_drone_test
#      - sudo git pull
#      - echo $${ENV}
#      - echo $${ENV} | sudo tee .env


#- name: build-nginx-image
#  pull: if-not-exists
#  image: plugins/docker
#  settings:
#    registry: registry.hub.docker.com
#    repo: registry.hub.docker.com/virtualorz/docker_compose_nginx_build
#    dockerfile: dockerfiles/dockerfile_for_nginx/Dockerfile
#    auto_tag: true
#    username: virtualorz
#    password: 2uxirgil

#- name: build-php-image
#  pull: if-not-exists
#  image: plugins/docker
#  settings:
#    registry: registry.hub.docker.com
#    repo: registry.hub.docker.com/virtualorz/dev_compose_php73_laravel_build
#    dockerfile: dockerfiles/dockerfile_for_laravel/Dockerfile
#    auto_tag: true
#    username: virtualorz
#    password: 2uxirgil
