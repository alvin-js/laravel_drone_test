---
kind: pipeline
type: docker
name: test

platform:
  os: linux
  arch: amd64

steps:
  - name: publish_nginx
    image: plugins/gcr
    settings:
      registry: asia.gcr.io
      repo: nodal-wall-248502/docker_compose_nginx_build
      tags: latest
      dockerfile: dockerfiles/dockerfile_for_nginx/Dockerfile
      json_key: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibm9kYWwtd2FsbC0yNDg1MDIiLAogICJwcml2YXRlX2tleV9pZCI6ICJmMzE3NGVkMTZhY2IxMDQ5Yjg3OGViOWIxYzBmYTgzMmY3NjAyZWFjIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdmdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLZ3dnZ1NrQWdFQUFvSUJBUUM1emswY0ZRS2E2cUVvXG5mM0RkSXZlbTIvc0J6YW8zK2pZQXFNeHRTbUdXd2FsWkJOZGk1WXBLSHViME12ZkZPanZRZTFIMGNKc0ptWWFmXG4yQTlHSDhYc2hzV1IyNFY1NFFHcG8rR2hQN3JQb1R4L1FRSnROUHdQbzQySGx4YUlGeGVmMVRuTjl4SzJRWnFmXG5RbXcycnpEaXNGUGZ3VFV5Zkpyd2NhNVRJK0JZZDlxTE83amJoMmx1Mlhha3RJK3RZMjNMMVdudDdYY2lxenEyXG5oaTRPYlVhaTBYd3p3anB6MC9jYmRhRm4wdUtPMTdDUldsdDhFLzl1ejdTMHBVUHRFL29pRzkwUDlJZXYwWHJjXG5QQ0pVRUp2UUd0dWxZdG1CekxhOUpWVzBkL2dRSHdqVTUzaHBJL1lJOStOeHBQVVFIRlFtbHN2R1JzQ2Ezd3lnXG5NN0M1cjU5UEFnTUJBQUVDZ2dFQU5VcGVvbEhDVkFVOFlKMmdsTVFkTEczR1laK0hsUk45M3BXTFFFTkhseElIXG5US0ZQVnkySGlyZXZQTlhMYTNWR3g0WS9ITEVaUGxrYW5BaS9aTGpqTHZIK2cxVm5SR3dNNm9jMnhPVSs0cU1YXG5jMVlGYUtYOEwwNFUzeEV0NUsxZTJMZ3lvb2lkQk1udkc0TlUveUFqRUxsSzdRK0FmdkR2RFV4Rmw5SGYyKzlTXG5FUkdEazk1b1lrM1FRS08xZFNyY0pkbFpyZGVlTDJEMi9PWFdwZk5VdDRrZWd5TDFWSUR2V3A3ZDZiZ3BSZlozXG5Bc2xUTGlNRWU2RnE0cUs5SGdxNzdsc05CUnlLS1JMR1lDOGZoZzQ0dlJoaHB2ckcrQWpGNGxxaFNNM3Z1akdUXG5OMXRDSk1NR1JaQzNRSUdHWkE5d3Y4aTRGSDFzOVNyT2JNRHNqTld1a1FLQmdRRDNuaE9OV21FMVpYWks3NXJoXG5zNHlZa3ZYKzBJQ1RuTFhrRnZseW1RNDJXVzJXd3dGTmE0M2kveWkvbFlnYU1YWCtVNWlZVXRYMlA1NlNEdGZiXG5tcUlRMlQ3TXlBNk9BTDZXNCsrR3Z1cjd4cmpQZlNJUWhUajRMM3NwTDhKNEpqNUx1ZVI2eUF3RURBbGZYc2s4XG5wMk1Xak9RSU9ScHNVV2NrYlIyK2M2ejA4UUtCZ1FEQUdJdzNtMmh1aGVHTmVkNlFCWHJHSmpiR0hJUCtkTHdBXG5lWC9DVGlCNnZ1cGxRYW9XSEFMOWxVSm9nUXNzTWNaK3RVNEdHRTNBVDVaZ1NFRTN6RzQ0Z2lRTTZHV3VwVGlPXG5XNkl0TlJDQkJ3U3oxaGdUc3dPOU5BeEExVFlQb0JpOG1qNzFLRnFYbElZN3c3RGFyTHAwa3BwYVNIWmhKajZmXG5OaWIxdXJUWVB3S0JnQ3ZSR0NxaVBLTmpRZXgrdTh5R3BqRjFoL3hBVHhCUDRjdnIyTlpUaVRWSzI5NmF3VWMrXG42Z3VxRlQ3WnFnemdoYjJzYzBzNUZVMk84bk5zRnZ4d1A0OTFzZXd3MW9xQVRUbU1PaDJBK1RuMmIwdWdIQUFLXG5Zd3RmODQ1Vk9qZGlwUkZuWXF2cmJGem0rRjJjKzBVMVpZNWUvaGNLYThlUkhBeFJGcnRWNHR3eEFvR0JBSnVLXG54TzY1emFQQWtGUUlIQ2l0NXkzTy80Y0d5L0liLzZhNnVySlFwSWYvVXJoT3BUUmwxaDRTMzhUU3lJTXVnclZTXG5oU3oyUE82OUF0eFBaVStUSHFSdTdGWHZUM1pNbmpEWERjaGhNVTNvcXV3YkxUKzJNZzdmdUJRL0VCa3kzeFRJXG5LTFpGeUtUNFJJRGNBYlh2S3NMOWVqSWtmb1pIZTJsYlpjeVBNNlB0QW9HQkFMdXA5eTJqbGN2Nk1PU0ZRdHg5XG5oby9vamt6bTFLYTI5Z0I2K291SnJkeGs5TjJJd2liNlUyaGgzeFBiS0NzMTVwdzJZTUtHUUxPL2dkelhITmlrXG5QUUdmb3hqbTkxdXJZejI4bmdKTXM1ZkRWd1dLcEY1TzFGbE1vcW00dkNhK3VobEsxVGhuV3d2SnJkekcvUkFwXG5TTTF1UXh3UUkwWFlHUVorNmQ5eFNsQS9cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJhY2Nlc3MtZ2NyQG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjExMzU4MTM2ODY2MDk5ODc2NzE5NiIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvYWNjZXNzLWdjciU0MG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9Cg==
  - name: publish_php
    image: plugins/gcr
    settings:
      registry: asia.gcr.io
      repo: nodal-wall-248502/docker_compose_php73_laravel_build
      tags: latest
      dockerfile: dockerfiles/dockerfile_for_laravel/Dockerfile
      json_key: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibm9kYWwtd2FsbC0yNDg1MDIiLAogICJwcml2YXRlX2tleV9pZCI6ICJmMzE3NGVkMTZhY2IxMDQ5Yjg3OGViOWIxYzBmYTgzMmY3NjAyZWFjIiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdmdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLZ3dnZ1NrQWdFQUFvSUJBUUM1emswY0ZRS2E2cUVvXG5mM0RkSXZlbTIvc0J6YW8zK2pZQXFNeHRTbUdXd2FsWkJOZGk1WXBLSHViME12ZkZPanZRZTFIMGNKc0ptWWFmXG4yQTlHSDhYc2hzV1IyNFY1NFFHcG8rR2hQN3JQb1R4L1FRSnROUHdQbzQySGx4YUlGeGVmMVRuTjl4SzJRWnFmXG5RbXcycnpEaXNGUGZ3VFV5Zkpyd2NhNVRJK0JZZDlxTE83amJoMmx1Mlhha3RJK3RZMjNMMVdudDdYY2lxenEyXG5oaTRPYlVhaTBYd3p3anB6MC9jYmRhRm4wdUtPMTdDUldsdDhFLzl1ejdTMHBVUHRFL29pRzkwUDlJZXYwWHJjXG5QQ0pVRUp2UUd0dWxZdG1CekxhOUpWVzBkL2dRSHdqVTUzaHBJL1lJOStOeHBQVVFIRlFtbHN2R1JzQ2Ezd3lnXG5NN0M1cjU5UEFnTUJBQUVDZ2dFQU5VcGVvbEhDVkFVOFlKMmdsTVFkTEczR1laK0hsUk45M3BXTFFFTkhseElIXG5US0ZQVnkySGlyZXZQTlhMYTNWR3g0WS9ITEVaUGxrYW5BaS9aTGpqTHZIK2cxVm5SR3dNNm9jMnhPVSs0cU1YXG5jMVlGYUtYOEwwNFUzeEV0NUsxZTJMZ3lvb2lkQk1udkc0TlUveUFqRUxsSzdRK0FmdkR2RFV4Rmw5SGYyKzlTXG5FUkdEazk1b1lrM1FRS08xZFNyY0pkbFpyZGVlTDJEMi9PWFdwZk5VdDRrZWd5TDFWSUR2V3A3ZDZiZ3BSZlozXG5Bc2xUTGlNRWU2RnE0cUs5SGdxNzdsc05CUnlLS1JMR1lDOGZoZzQ0dlJoaHB2ckcrQWpGNGxxaFNNM3Z1akdUXG5OMXRDSk1NR1JaQzNRSUdHWkE5d3Y4aTRGSDFzOVNyT2JNRHNqTld1a1FLQmdRRDNuaE9OV21FMVpYWks3NXJoXG5zNHlZa3ZYKzBJQ1RuTFhrRnZseW1RNDJXVzJXd3dGTmE0M2kveWkvbFlnYU1YWCtVNWlZVXRYMlA1NlNEdGZiXG5tcUlRMlQ3TXlBNk9BTDZXNCsrR3Z1cjd4cmpQZlNJUWhUajRMM3NwTDhKNEpqNUx1ZVI2eUF3RURBbGZYc2s4XG5wMk1Xak9RSU9ScHNVV2NrYlIyK2M2ejA4UUtCZ1FEQUdJdzNtMmh1aGVHTmVkNlFCWHJHSmpiR0hJUCtkTHdBXG5lWC9DVGlCNnZ1cGxRYW9XSEFMOWxVSm9nUXNzTWNaK3RVNEdHRTNBVDVaZ1NFRTN6RzQ0Z2lRTTZHV3VwVGlPXG5XNkl0TlJDQkJ3U3oxaGdUc3dPOU5BeEExVFlQb0JpOG1qNzFLRnFYbElZN3c3RGFyTHAwa3BwYVNIWmhKajZmXG5OaWIxdXJUWVB3S0JnQ3ZSR0NxaVBLTmpRZXgrdTh5R3BqRjFoL3hBVHhCUDRjdnIyTlpUaVRWSzI5NmF3VWMrXG42Z3VxRlQ3WnFnemdoYjJzYzBzNUZVMk84bk5zRnZ4d1A0OTFzZXd3MW9xQVRUbU1PaDJBK1RuMmIwdWdIQUFLXG5Zd3RmODQ1Vk9qZGlwUkZuWXF2cmJGem0rRjJjKzBVMVpZNWUvaGNLYThlUkhBeFJGcnRWNHR3eEFvR0JBSnVLXG54TzY1emFQQWtGUUlIQ2l0NXkzTy80Y0d5L0liLzZhNnVySlFwSWYvVXJoT3BUUmwxaDRTMzhUU3lJTXVnclZTXG5oU3oyUE82OUF0eFBaVStUSHFSdTdGWHZUM1pNbmpEWERjaGhNVTNvcXV3YkxUKzJNZzdmdUJRL0VCa3kzeFRJXG5LTFpGeUtUNFJJRGNBYlh2S3NMOWVqSWtmb1pIZTJsYlpjeVBNNlB0QW9HQkFMdXA5eTJqbGN2Nk1PU0ZRdHg5XG5oby9vamt6bTFLYTI5Z0I2K291SnJkeGs5TjJJd2liNlUyaGgzeFBiS0NzMTVwdzJZTUtHUUxPL2dkelhITmlrXG5QUUdmb3hqbTkxdXJZejI4bmdKTXM1ZkRWd1dLcEY1TzFGbE1vcW00dkNhK3VobEsxVGhuV3d2SnJkekcvUkFwXG5TTTF1UXh3UUkwWFlHUVorNmQ5eFNsQS9cbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJhY2Nlc3MtZ2NyQG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjExMzU4MTM2ODY2MDk5ODc2NzE5NiIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvYWNjZXNzLWdjciU0MG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9Cg==

#- name: ssh-git-pull
#  pull: if-not-exists
#  image: appleboy/drone-ssh
#  environment:
#    ENV:
#      from_secret: env
#  settings:
#    host: 35.229.238.232
#    username: alvin
#    port: 22
#    key:
#      from_secret: privateKey
#    envs: [ENV]
#    script:
#      - cd /var/www/html/laravel_drone_test
#      - sudo git pull
#      - echo $${ENV}
#      - echo $${ENV} | sudo tee .env


#- name: build-nginx-image
#  pull: if-not-exists
#  image: plugins/docker
#  settings:
#    registry: registry.hub.docker.com
#    repo: registry.hub.docker.com/virtualorz/docker_compose_nginx_build
#    dockerfile: dockerfiles/dockerfile_for_nginx/Dockerfile
#    auto_tag: true
#    username: virtualorz
#    password: 2uxirgil

#- name: build-php-image
#  pull: if-not-exists
#  image: plugins/docker
#  settings:
#    registry: registry.hub.docker.com
#    repo: registry.hub.docker.com/virtualorz/dev_compose_php73_laravel_build
#    dockerfile: dockerfiles/dockerfile_for_laravel/Dockerfile
#    auto_tag: true
#    username: virtualorz
#    password: 2uxirgil
