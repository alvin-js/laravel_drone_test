---
kind: pipeline
type: docker
name: test

platform:
  os: linux
  arch: amd64

steps:
  - name: publish_nginx
    image: plugins/gcr
    settings:
      registry: asia.gcr.io
      repo: nodal-wall-248502/docker_compose_nginx_build
      tags: latest
      dockerfile: dockerfiles/dockerfile_for_nginx/Dockerfile
      json_key: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibm9kYWwtd2FsbC0yNDg1MDIiLAogICJwcml2YXRlX2tleV9pZCI6ICIxYzYxZTQ5ZTZiY2ViNGNlMDlkMzlhNzI0NmRhZGRlMzNjZjQ0MTY5IiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdmdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLZ3dnZ1NrQWdFQUFvSUJBUUREMDltMGRXaEUyK2JVXG4xVDN1c2pNOWtOUFZUZm5JUWs4MW02blVlNTQrWm1SWFJ5ekNFUTZNNWROQUdFZWxIWXY5dWFsUEZ6RWVEQzRaXG5ycVlGU0I0OVIyQzBzaUU4RGNWQStMdjVzdHN5LzhhQ1YyQWlkY3JvWFpIbFpXTUZoOWtySjN4NWhySmJKYVM2XG5hanRWeExLTUhpR3I5UkwzcXhTOWNoTXNGUGVvSWU1azNOeS80bEdVVE84U3NDQThIaWl4Rm9hTWpQaDA2clFKXG5iSllBdzM3RGJQRXo2ejFLd0hienc0ZFF2cEE0MW9OYXc3cWVzcVhnNkpOOWFWWXkyMTUreXlXQlgyMFpLSlhmXG5wejdRZGVEbVBIZkVkUk5CM0JUZnVIRHFWUnNvS3hJUkJybkppdEh5cjZ1TEJMazlzdjNmTDhJQ2NqMU40cFg3XG5KOTJrMmQwWEFnTUJBQUVDZ2dFQUFWSWFjOGNlN3VmMHhKYXpsanFKY2U3YUh1UXB2Um9GWXIwc0JnelhZbUJhXG5hT1JIL3Y4U2RBelF3ZXZuLzhzVk9KN1o3M2lla2k5TzJFbC9RU1hkWGxodTVJa1hCRXFyZStheGpkdVE4dVVhXG50NkpUT2FoRnVBOTVmbXlTb0dUc0tBaGFKSSt1QUVOZXV3c2dYMUcyU28raGRvRnVvVkQ4RU5NR0loUDZINTRuXG43c0lRY2h3SG1YbTQydDJlcklMMzZZMEs4VnNieUQrdlpFeGloUWFiZS9IQkZma2cwWkFxOG81UjduaWRYR3dGXG5DTXBydzBRVnZ2VFpnWlkyVEZSdzBOUWhwdlEvSE1aSUI5eGgyWFFxWUFOM1c5N3NObEdCajhuWjQ3SXNvVEplXG5qSDBic291eFJ5QTIvTzVOYlFJakRPcEJ0OVYrZkNVQUZqMmd4TFB2OFFLQmdRRDJWcXd5emcrVVRtREZ4ZGNJXG5lTHNFZGc1L0p0N3MzRUJsdmtyMklZWHRNZVdid2I1YktzSkU5UHJrZkNSZXA1dzNqVmZPN3cxYnJoV2c5ZDByXG5wdi9lNFl0alFsRGJuYklaTWZLRTBsTCtUT0txSk1PeEk4ZTBkYWZoUktFQTBpTnVaUERUd2d4a3RTajBPcmlsXG44cnJJKzE5UC8wQTBhaFYwZEJPWHR1ZXlzd0tCZ1FETGdnZHNjMGtQemRoSEU5QVhyK2J6Unpoay9vNGNMNC9mXG5HWE5sSXU2QkNCK2tYNFIxL3Z5OXZTNUtWZ1lFOHVPN3NlK25oZ2hTM01KMlZMNEs5TmRjSU1FM3hYeVROU2RBXG5YR0Y5MmpmVndOUExzT2ZIVmRnMTlwRlRySjNudTJOTVRDT3c4ZGFRclFZU0tWTFJxaldRODBZN2hEc2Q4eWlDXG5IS3lYKzNBT0RRS0JnR0N2MWppK3JsaThocms1bE5RTFp3UXlQakJrRmwyTGVXODF5SUJnMmdzbWFZUEFBTElSXG56MXgzZHo1VkI0VnJiaUpUeE9KQTY5SlBPc2dKbUh5NHVIZEh1WWtGRDIyVHNNSzQyd0tNOXV3L1N6d1M0QWhZXG5EZHRqenJmWlV3UmFkbk92Qk9Ob3A2cWpmR2FYNGIrb3pPMXoxSTQybG9HOEhaMnVyYjMvbVdPSEFvR0JBSWU2XG4yN1NyVjJsaEF3UzA1QzlJTktMQk40MjBjWmUrNlJnRlkzOXF3dVB3UlJwZVVueFlhcjBwdGZ3Q1Q5VnhJZzZIXG5hSzIwcVV5S3pIQWJxUHlwdkJGSUQxWmhNdXNEb29BOG5SRlJQN2dpK1o5N0I3dGROKzBWM0d1UVQyakZCRDlZXG44TjBORHV4RFdpODJ2SFAyTCsvVE1WNTBuUEVtd2plMVpDK2hsV1RwQW9HQkFMN3RJMkJhYWtXam1nd2YzcDBWXG5YMVE3bjZsdDdMNVJsMDByOUtBMGt0anFZaGdCYWZJRzhjWXBCVXBjODU0bTRvVEhja3ZzQjBSeTBERjJrQTluXG54M3NiUDBxZ29xRUJMbTB1MHVGMWE5V3AzbG5IZEd3YzNQMzRGY25DSjhnOHhaN21laEJDZHN2ZjFjUS9YUis1XG56RGwzcTM2Wkx5V3VXWHE5N0pZSStYRTFcbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJhY2Nlc3MtZ2NyLWltYWdlQG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjExNTA3NDk4MzE0OTU0MzY1ODUwNSIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvYWNjZXNzLWdjci1pbWFnZSU0MG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9Cg==
  - name: publish_php
    image: plugins/gcr
    settings:
      registry: asia.gcr.io
      repo: nodal-wall-248502/docker_compose_php73_laravel_build
      tags: latest
      dockerfile: dockerfiles/dockerfile_for_laravel/Dockerfile
      json_key: ewogICJ0eXBlIjogInNlcnZpY2VfYWNjb3VudCIsCiAgInByb2plY3RfaWQiOiAibm9kYWwtd2FsbC0yNDg1MDIiLAogICJwcml2YXRlX2tleV9pZCI6ICIxYzYxZTQ5ZTZiY2ViNGNlMDlkMzlhNzI0NmRhZGRlMzNjZjQ0MTY5IiwKICAicHJpdmF0ZV9rZXkiOiAiLS0tLS1CRUdJTiBQUklWQVRFIEtFWS0tLS0tXG5NSUlFdmdJQkFEQU5CZ2txaGtpRzl3MEJBUUVGQUFTQ0JLZ3dnZ1NrQWdFQUFvSUJBUUREMDltMGRXaEUyK2JVXG4xVDN1c2pNOWtOUFZUZm5JUWs4MW02blVlNTQrWm1SWFJ5ekNFUTZNNWROQUdFZWxIWXY5dWFsUEZ6RWVEQzRaXG5ycVlGU0I0OVIyQzBzaUU4RGNWQStMdjVzdHN5LzhhQ1YyQWlkY3JvWFpIbFpXTUZoOWtySjN4NWhySmJKYVM2XG5hanRWeExLTUhpR3I5UkwzcXhTOWNoTXNGUGVvSWU1azNOeS80bEdVVE84U3NDQThIaWl4Rm9hTWpQaDA2clFKXG5iSllBdzM3RGJQRXo2ejFLd0hienc0ZFF2cEE0MW9OYXc3cWVzcVhnNkpOOWFWWXkyMTUreXlXQlgyMFpLSlhmXG5wejdRZGVEbVBIZkVkUk5CM0JUZnVIRHFWUnNvS3hJUkJybkppdEh5cjZ1TEJMazlzdjNmTDhJQ2NqMU40cFg3XG5KOTJrMmQwWEFnTUJBQUVDZ2dFQUFWSWFjOGNlN3VmMHhKYXpsanFKY2U3YUh1UXB2Um9GWXIwc0JnelhZbUJhXG5hT1JIL3Y4U2RBelF3ZXZuLzhzVk9KN1o3M2lla2k5TzJFbC9RU1hkWGxodTVJa1hCRXFyZStheGpkdVE4dVVhXG50NkpUT2FoRnVBOTVmbXlTb0dUc0tBaGFKSSt1QUVOZXV3c2dYMUcyU28raGRvRnVvVkQ4RU5NR0loUDZINTRuXG43c0lRY2h3SG1YbTQydDJlcklMMzZZMEs4VnNieUQrdlpFeGloUWFiZS9IQkZma2cwWkFxOG81UjduaWRYR3dGXG5DTXBydzBRVnZ2VFpnWlkyVEZSdzBOUWhwdlEvSE1aSUI5eGgyWFFxWUFOM1c5N3NObEdCajhuWjQ3SXNvVEplXG5qSDBic291eFJ5QTIvTzVOYlFJakRPcEJ0OVYrZkNVQUZqMmd4TFB2OFFLQmdRRDJWcXd5emcrVVRtREZ4ZGNJXG5lTHNFZGc1L0p0N3MzRUJsdmtyMklZWHRNZVdid2I1YktzSkU5UHJrZkNSZXA1dzNqVmZPN3cxYnJoV2c5ZDByXG5wdi9lNFl0alFsRGJuYklaTWZLRTBsTCtUT0txSk1PeEk4ZTBkYWZoUktFQTBpTnVaUERUd2d4a3RTajBPcmlsXG44cnJJKzE5UC8wQTBhaFYwZEJPWHR1ZXlzd0tCZ1FETGdnZHNjMGtQemRoSEU5QVhyK2J6Unpoay9vNGNMNC9mXG5HWE5sSXU2QkNCK2tYNFIxL3Z5OXZTNUtWZ1lFOHVPN3NlK25oZ2hTM01KMlZMNEs5TmRjSU1FM3hYeVROU2RBXG5YR0Y5MmpmVndOUExzT2ZIVmRnMTlwRlRySjNudTJOTVRDT3c4ZGFRclFZU0tWTFJxaldRODBZN2hEc2Q4eWlDXG5IS3lYKzNBT0RRS0JnR0N2MWppK3JsaThocms1bE5RTFp3UXlQakJrRmwyTGVXODF5SUJnMmdzbWFZUEFBTElSXG56MXgzZHo1VkI0VnJiaUpUeE9KQTY5SlBPc2dKbUh5NHVIZEh1WWtGRDIyVHNNSzQyd0tNOXV3L1N6d1M0QWhZXG5EZHRqenJmWlV3UmFkbk92Qk9Ob3A2cWpmR2FYNGIrb3pPMXoxSTQybG9HOEhaMnVyYjMvbVdPSEFvR0JBSWU2XG4yN1NyVjJsaEF3UzA1QzlJTktMQk40MjBjWmUrNlJnRlkzOXF3dVB3UlJwZVVueFlhcjBwdGZ3Q1Q5VnhJZzZIXG5hSzIwcVV5S3pIQWJxUHlwdkJGSUQxWmhNdXNEb29BOG5SRlJQN2dpK1o5N0I3dGROKzBWM0d1UVQyakZCRDlZXG44TjBORHV4RFdpODJ2SFAyTCsvVE1WNTBuUEVtd2plMVpDK2hsV1RwQW9HQkFMN3RJMkJhYWtXam1nd2YzcDBWXG5YMVE3bjZsdDdMNVJsMDByOUtBMGt0anFZaGdCYWZJRzhjWXBCVXBjODU0bTRvVEhja3ZzQjBSeTBERjJrQTluXG54M3NiUDBxZ29xRUJMbTB1MHVGMWE5V3AzbG5IZEd3YzNQMzRGY25DSjhnOHhaN21laEJDZHN2ZjFjUS9YUis1XG56RGwzcTM2Wkx5V3VXWHE5N0pZSStYRTFcbi0tLS0tRU5EIFBSSVZBVEUgS0VZLS0tLS1cbiIsCiAgImNsaWVudF9lbWFpbCI6ICJhY2Nlc3MtZ2NyLWltYWdlQG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIiwKICAiY2xpZW50X2lkIjogIjExNTA3NDk4MzE0OTU0MzY1ODUwNSIsCiAgImF1dGhfdXJpIjogImh0dHBzOi8vYWNjb3VudHMuZ29vZ2xlLmNvbS9vL29hdXRoMi9hdXRoIiwKICAidG9rZW5fdXJpIjogImh0dHBzOi8vb2F1dGgyLmdvb2dsZWFwaXMuY29tL3Rva2VuIiwKICAiYXV0aF9wcm92aWRlcl94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL29hdXRoMi92MS9jZXJ0cyIsCiAgImNsaWVudF94NTA5X2NlcnRfdXJsIjogImh0dHBzOi8vd3d3Lmdvb2dsZWFwaXMuY29tL3JvYm90L3YxL21ldGFkYXRhL3g1MDkvYWNjZXNzLWdjci1pbWFnZSU0MG5vZGFsLXdhbGwtMjQ4NTAyLmlhbS5nc2VydmljZWFjY291bnQuY29tIgp9Cg==

#- name: ssh-git-pull
#  pull: if-not-exists
#  image: appleboy/drone-ssh
#  environment:
#    ENV:
#      from_secret: env
#  settings:
#    host: 35.229.238.232
#    username: alvin
#    port: 22
#    key:
#      from_secret: privateKey
#    envs: [ENV]
#    script:
#      - cd /var/www/html/laravel_drone_test
#      - sudo git pull
#      - echo $${ENV}
#      - echo $${ENV} | sudo tee .env


#- name: build-nginx-image
#  pull: if-not-exists
#  image: plugins/docker
#  settings:
#    registry: registry.hub.docker.com
#    repo: registry.hub.docker.com/virtualorz/docker_compose_nginx_build
#    dockerfile: dockerfiles/dockerfile_for_nginx/Dockerfile
#    auto_tag: true
#    username: virtualorz
#    password: 2uxirgil

#- name: build-php-image
#  pull: if-not-exists
#  image: plugins/docker
#  settings:
#    registry: registry.hub.docker.com
#    repo: registry.hub.docker.com/virtualorz/dev_compose_php73_laravel_build
#    dockerfile: dockerfiles/dockerfile_for_laravel/Dockerfile
#    auto_tag: true
#    username: virtualorz
#    password: 2uxirgil
